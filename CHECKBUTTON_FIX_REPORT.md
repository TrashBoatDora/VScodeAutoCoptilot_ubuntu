# å‹¾é¸æ¡†çµ±è¨ˆæ›´æ–°å•é¡Œä¿®æ­£å ±å‘Š

**æ—¥æœŸ**: 2025-10-14  
**å•é¡Œ**: å‹¾é¸å°ˆæ¡ˆå¾Œï¼Œçµ±è¨ˆé¡¯ç¤ºä¸æ›´æ–°ï¼ˆä¸€ç›´é¡¯ç¤ºã€Œå·²é¸æ“‡: 0 å€‹å°ˆæ¡ˆã€ï¼‰

---

## ğŸ› å•é¡Œåˆ†æ

### åŸå§‹ä»£ç¢¼
```python
checkbox = ttk.Checkbutton(
    item_frame,
    variable=var,
    command=self.update_stats  # â† ä½¿ç”¨ command åƒæ•¸
)
```

### å•é¡ŒåŸå› 
`ttk.Checkbutton` çš„ `command` åƒæ•¸åœ¨æŸäº›æƒ…æ³ä¸‹å¯èƒ½ä¸æœƒåœ¨è®Šæ•¸æ”¹è®Šæ™‚ç«‹å³è§¸ç™¼ï¼Œç‰¹åˆ¥æ˜¯ï¼š
1. ç•¶å‹¾é¸æ¡†å¿«é€Ÿé»æ“Šæ™‚
2. ç•¶é€éç¨‹å¼ç¢¼è¨­å®šè®Šæ•¸æ™‚ï¼ˆå¦‚å…¨é¸/å…¨ä¸é¸ï¼‰
3. UI æ›´æ–°å»¶é²

---

## ğŸ”§ ä¿®æ­£æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šä½¿ç”¨è®Šæ•¸è¿½è¹¤ï¼ˆVariable Traceï¼‰

æ”¹ç”¨ Tkinter çš„è®Šæ•¸è¿½è¹¤æ©Ÿåˆ¶ï¼Œç›´æ¥ç›£è½ `BooleanVar` çš„è®ŠåŒ–ã€‚

#### ä¿®æ­£å¾Œä»£ç¢¼
```python
def _create_project_item(self, parent, project: dict):
    """å‰µå»ºå–®å€‹å°ˆæ¡ˆé …ç›®"""
    item_frame = ttk.Frame(parent)
    item_frame.pack(fill="x", padx=5, pady=3)
    
    # å‹¾é¸æ¡†
    var = tk.BooleanVar(value=False)
    self.project_vars[project['name']] = var
    
    # âœ… ä½¿ç”¨ trace ç›£è½è®Šæ•¸è®ŠåŒ–ï¼ˆæ›´å¯é ï¼‰
    var.trace('w', lambda *args: self.update_stats())
    
    checkbox = ttk.Checkbutton(
        item_frame,
        variable=var  # â† ç§»é™¤ command åƒæ•¸
    )
    checkbox.pack(side="left", padx=(0, 10))
    # ...
```

#### å¢å¼· update_stats æ–¹æ³•
```python
def update_stats(self):
    """æ›´æ–°çµ±è¨ˆè³‡è¨Š"""
    selected_count = sum(1 for var in self.project_vars.values() if var.get())
    text = f"å·²é¸æ“‡: {selected_count} å€‹å°ˆæ¡ˆ"
    self.stats_label.config(text=text)
    self.stats_label.update_idletasks()  # âœ… å¼·åˆ¶ç«‹å³æ›´æ–° UI
    logger.debug(f"çµ±è¨ˆæ›´æ–°: {text}")     # âœ… èª¿è©¦æ—¥èªŒ
```

---

## ğŸ“Š å°æ¯”

| æ–¹æ³• | å„ªé» | ç¼ºé» | å¯é æ€§ |
|------|------|------|--------|
| **command** | ç°¡å–®ç›´æ¥ | å¯èƒ½ä¸è§¸ç™¼ | â­â­â­ |
| **trace** | ç›£è½è®Šæ•¸è®ŠåŒ– | ç¨å¾®è¤‡é›œ | â­â­â­â­â­ |

---

## ğŸ§ª æ¸¬è©¦

### ç°¡å–®æ¸¬è©¦
```bash
python test_checkbutton.py
```

é€™å€‹æ¸¬è©¦ç¨‹å¼æœƒå‰µå»º 5 å€‹å‹¾é¸æ¡†ï¼Œé©—è­‰ï¼š
1. å–®å€‹å‹¾é¸æ˜¯å¦æ›´æ–°çµ±è¨ˆ
2. å…¨é¸æŒ‰éˆ•æ˜¯å¦æ›´æ–°çµ±è¨ˆ
3. å…¨ä¸é¸æŒ‰éˆ•æ˜¯å¦æ›´æ–°çµ±è¨ˆ

### å®Œæ•´æ¸¬è©¦
```bash
python test_project_selector_fixed.py
```

---

## âœ… é©—è­‰æ­¥é©Ÿ

1. **å•Ÿå‹•å°ˆæ¡ˆé¸æ“‡å™¨**
   ```bash
   python main.py
   ```

2. **é»æ“Šã€Œç€è¦½å°ˆæ¡ˆã€æŒ‰éˆ•**

3. **æ¸¬è©¦å–®å€‹å‹¾é¸**
   - å‹¾é¸ä¸€å€‹å°ˆæ¡ˆ
   - æª¢æŸ¥å·¦ä¸‹è§’æ˜¯å¦é¡¯ç¤ºã€Œå·²é¸æ“‡: 1 å€‹å°ˆæ¡ˆã€

4. **æ¸¬è©¦å¤šå€‹å‹¾é¸**
   - å‹¾é¸ç¬¬äºŒå€‹å°ˆæ¡ˆ
   - æª¢æŸ¥æ˜¯å¦é¡¯ç¤ºã€Œå·²é¸æ“‡: 2 å€‹å°ˆæ¡ˆã€

5. **æ¸¬è©¦å¿«é€Ÿé¸æ“‡**
   - é»æ“Šã€Œå…¨é¸ã€â†’ æ‡‰é¡¯ç¤ºå…¨éƒ¨æ•¸é‡
   - é»æ“Šã€Œå…¨ä¸é¸ã€â†’ æ‡‰é¡¯ç¤ºã€Œå·²é¸æ“‡: 0 å€‹å°ˆæ¡ˆã€
   - é»æ“Šã€Œåé¸ã€â†’ æ•¸é‡æ‡‰è©²åè½‰

6. **æ¸¬è©¦å–æ¶ˆå‹¾é¸**
   - å–æ¶ˆå‹¾é¸ä¸€å€‹å°ˆæ¡ˆ
   - æª¢æŸ¥æ•¸é‡æ˜¯å¦æ¸›å°‘

---

## ğŸ” èª¿è©¦æ–¹æ³•

å¦‚æœçµ±è¨ˆä»ç„¶ä¸æ›´æ–°ï¼Œæª¢æŸ¥æ§åˆ¶å°æ—¥èªŒï¼š

```bash
# æ‡‰è©²çœ‹åˆ°é¡ä¼¼è¼¸å‡ºï¼š
2025-10-14 16:00:00,000 - ProjectSelectorUI - DEBUG - çµ±è¨ˆæ›´æ–°: å·²é¸æ“‡: 1 å€‹å°ˆæ¡ˆ
2025-10-14 16:00:01,000 - ProjectSelectorUI - DEBUG - çµ±è¨ˆæ›´æ–°: å·²é¸æ“‡: 2 å€‹å°ˆæ¡ˆ
2025-10-14 16:00:02,000 - ProjectSelectorUI - DEBUG - çµ±è¨ˆæ›´æ–°: å·²é¸æ“‡: 0 å€‹å°ˆæ¡ˆ
```

å¦‚æœçœ‹ä¸åˆ°é€™äº›æ—¥èªŒï¼Œèªªæ˜ï¼š
1. `trace` æ²’æœ‰è¢«è§¸ç™¼ â†’ æª¢æŸ¥è®Šæ•¸ç¶å®š
2. `update_stats()` æ²’æœ‰è¢«èª¿ç”¨ â†’ æª¢æŸ¥ lambda å‡½æ•¸

---

## ğŸ“ æŠ€è¡“ç´°ç¯€

### Tkinter è®Šæ•¸è¿½è¹¤

```python
# trace æ–¹æ³•ç°½å
var.trace(mode, callback)

# mode é¸é …:
# 'w' - write: è®Šæ•¸è¢«å¯«å…¥æ™‚è§¸ç™¼
# 'r' - read: è®Šæ•¸è¢«è®€å–æ™‚è§¸ç™¼
# 'u' - undefine: è®Šæ•¸è¢«åˆªé™¤æ™‚è§¸ç™¼

# ä½¿ç”¨ 'w' ç›£è½è®Šæ•¸è®ŠåŒ–
var.trace('w', lambda *args: self.update_stats())
```

### ç‚ºä»€éº¼ä½¿ç”¨ lambda?

```python
# âŒ éŒ¯èª¤ï¼šæœƒç«‹å³èª¿ç”¨å‡½æ•¸
var.trace('w', self.update_stats())

# âœ… æ­£ç¢ºï¼šå‚³éå‡½æ•¸å¼•ç”¨
var.trace('w', lambda *args: self.update_stats())
```

`trace` çš„å›èª¿å‡½æ•¸æœƒæ¥æ”¶ 3 å€‹åƒæ•¸ï¼š
- `name`: è®Šæ•¸åç¨±
- `index`: é™£åˆ—ç´¢å¼•ï¼ˆå¦‚æœæ˜¯é™£åˆ—è®Šæ•¸ï¼‰
- `mode`: è§¸ç™¼æ¨¡å¼

ä½¿ç”¨ `lambda *args` å¿½ç•¥é€™äº›åƒæ•¸ã€‚

---

## ğŸ¯ é æœŸçµæœ

ä¿®æ­£å¾Œï¼Œå‹¾é¸æ¡†æ‡‰è©²ï¼š

âœ… **å–®å€‹å‹¾é¸** â†’ ç«‹å³æ›´æ–°çµ±è¨ˆ  
âœ… **å¿«é€Ÿé€£çºŒå‹¾é¸** â†’ æ¯æ¬¡éƒ½æ›´æ–°  
âœ… **å…¨é¸æŒ‰éˆ•** â†’ æ›´æ–°ç‚ºç¸½æ•¸  
âœ… **å…¨ä¸é¸æŒ‰éˆ•** â†’ æ›´æ–°ç‚º 0  
âœ… **åé¸æŒ‰éˆ•** â†’ æ­£ç¢ºè¨ˆç®—åè½‰å¾Œçš„æ•¸é‡  
âœ… **å–æ¶ˆå‹¾é¸** â†’ æ•¸é‡æ¸›å°‘  

---

## ğŸ”„ å›é€€æ–¹æ¡ˆ

å¦‚æœ `trace` æ–¹æ³•ä»ç„¶æœ‰å•é¡Œï¼Œå¯ä»¥å›é€€åˆ°å¼·åˆ¶æ›´æ–°æ–¹æ¡ˆï¼š

```python
def _create_project_item(self, parent, project: dict):
    # ...
    def on_check():
        self.root.after(10, self.update_stats)  # å»¶é² 10ms æ›´æ–°
    
    checkbox = ttk.Checkbutton(
        item_frame,
        variable=var,
        command=on_check
    )
```

---

## ğŸ“Œ ç¸½çµ

### ä¿®æ­£å…§å®¹
1. âœ… å¾ `command` æ”¹ç‚º `trace` ç›£è½è®Šæ•¸è®ŠåŒ–
2. âœ… å¢åŠ  `update_idletasks()` å¼·åˆ¶ UI æ›´æ–°
3. âœ… å¢åŠ èª¿è©¦æ—¥èªŒè¼¸å‡º

### ä¿®æ­£æª”æ¡ˆ
- `src/project_selector_ui.py`
  - `_create_project_item()` æ–¹æ³•
  - `update_stats()` æ–¹æ³•

### æ¸¬è©¦æª”æ¡ˆ
- `test_checkbutton.py` - ç°¡å–®æ¸¬è©¦
- `test_project_selector_fixed.py` - å®Œæ•´æ¸¬è©¦

---

**ä¿®æ­£å®Œæˆæ™‚é–“**: 2025-10-14  
**ç‹€æ…‹**: âœ… å·²ä¿®æ­£ï¼Œç­‰å¾…æ¸¬è©¦é©—è­‰
