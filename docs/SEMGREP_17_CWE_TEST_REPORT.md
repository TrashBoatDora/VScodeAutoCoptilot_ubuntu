# Semgrep å° 17 ç¨® CWE æ¼æ´çš„æª¢æ¸¬èƒ½åŠ›æ¸¬è©¦å ±å‘Š

**æ¸¬è©¦æ—¥æœŸ**: 2025-11-19  
**æ¸¬è©¦æ–‡ä»¶**: `tests/test_samples/all_cwe_samples.py`  
**Semgrep ç‰ˆæœ¬**: æœ€æ–°ï¼ˆconda ç’°å¢ƒï¼‰  
**Python å°ˆæ¡ˆç‰ˆæœ¬**: 3.10

---

## ğŸ“Š æ¸¬è©¦çµæœç¸½è¦½

| å·¥å…· | æˆåŠŸæª¢æ¸¬ | æª¢æ¸¬ç‡ |
|------|---------|--------|
| **Semgrep** | 1/15 | 6.7% |
| **Bandit** | 7/15 | 46.7% |

> **é‡è¦ç™¼ç¾**: Semgrep çš„æª¢æ¸¬ç‡é ä½æ–¼é æœŸï¼Œä¸»è¦åŸå› æ˜¯**è¦å‰‡é…ç½®éŒ¯èª¤**ï¼ˆå¤šå€‹ CWE é¡¯ç¤º "No config given"ï¼‰

---

## ğŸ“‹ å„ CWE æª¢æ¸¬è©³æƒ…

### âœ… Semgrep æˆåŠŸæª¢æ¸¬ (1/15)

| CWE | åç¨± | æª¢æ¸¬çµæœ | å‚™è¨» |
|-----|------|----------|------|
| **095** | Eval Injection | âœ… 1 å€‹æ¼æ´ | "Detected the use of eval()" |

### âŒ Semgrep æœªæª¢æ¸¬åˆ° (14/15)

| CWE | åç¨± | Semgrep | Bandit | åŸå› åˆ†æ |
|-----|------|---------|--------|----------|
| **022** | Path Traversal | âŒ | âŒ | âš ï¸ è¦å‰‡éŒ¯èª¤: "No config given" |
| **078** | Command Injection | âŒ | âœ… 1 | âš ï¸ è¦å‰‡å¯èƒ½éæ–¼åš´æ ¼ï¼Œæœªæª¢æ¸¬åˆ° `os.system()` |
| **079** | XSS | âŒ | âŒ | âš ï¸ è¦å‰‡å¯èƒ½åªé‡å°ç‰¹å®šæ¡†æ¶ç”¨æ³• |
| **113** | HTTP Response Splitting | âŒ | âŒ | âš ï¸ è¦å‰‡éŒ¯èª¤: "No config given" |
| **326** | Weak Encryption | âŒ | âœ… 1 | âš ï¸ è¦å‰‡æœªæª¢æ¸¬åˆ° RSA-512 |
| **327** | Broken Crypto | âŒ | âœ… 1 | âš ï¸ è¦å‰‡æœªæª¢æ¸¬åˆ° MD5 ä½¿ç”¨ |
| **329** | Predictable IV | âŒ | âŒ | âš ï¸ è¦å‰‡å¯èƒ½éæ–¼åš´æ ¼ |
| **347** | JWT No Verify | âŒ | âŒ | âš ï¸ è¦å‰‡å¯èƒ½ä¸åŒ¹é… `verify_signature=False` |
| **377** | Insecure Temp File | âŒ | âœ… 1 | âš ï¸ è¦å‰‡éŒ¯èª¤: "No config given" |
| **502** | Unsafe Deserialization | âŒ | âœ… 1 | âš ï¸ è¦å‰‡æœªæª¢æ¸¬åˆ° `pickle.loads()` |
| **643** | XPath Injection | âŒ | âŒ | âš ï¸ è¦å‰‡éŒ¯èª¤: "No config given" |
| **760** | Predictable Salt | âŒ | âŒ | âš ï¸ è¦å‰‡ä¸åŒ¹é…ï¼ˆä½¿ç”¨RSAè¦å‰‡ä»£æ›¿ï¼‰ |
| **918** | SSRF | âŒ | âœ… 2 | âš ï¸ è¦å‰‡æœªæª¢æ¸¬åˆ° `requests.get()` |
| **943** | NoSQL Injection | âŒ | âŒ | âš ï¸ è¦å‰‡éŒ¯èª¤: "No config given" |

---

## ğŸ” é—œéµå•é¡Œåˆ†æ

### 1. **è¦å‰‡é…ç½®éŒ¯èª¤** (æœ€åš´é‡)

ä»¥ä¸‹ CWE çš„ Semgrep è¦å‰‡è¿”å› "No config given" éŒ¯èª¤ï¼š
- CWE-022 (Path Traversal)
- CWE-113 (HTTP Response Splitting)
- CWE-377 (Insecure Temp File)
- CWE-643 (XPath Injection)
- CWE-943 (NoSQL Injection)

**åŸå› **: é€™äº›è¦å‰‡ ID åœ¨ Semgrep registry ä¸­**ä¸å­˜åœ¨æˆ–å·²éæ™‚**

### 2. **è¦å‰‡éæ–¼åš´æ ¼æˆ–ä¸åŒ¹é…** (æ¬¡è¦å•é¡Œ)

- **CWE-078**: è¦å‰‡ `dangerous-subprocess-use` æ‡‰è©²æª¢æ¸¬ `os.system()`ï¼Œä½†æ²’æœ‰
- **CWE-327**: è¦å‰‡ `md5-used` æ‡‰è©²æª¢æ¸¬ `hashlib.md5()`ï¼Œä½†æ²’æœ‰
- **CWE-502**: è¦å‰‡ `avoid-pyyaml-load` é‡å° YAMLï¼Œä¸æª¢æ¸¬ `pickle`
- **CWE-918**: è¦å‰‡ `disabled-cert-validation` ä¸æª¢æ¸¬é€šç”¨çš„ SSRF

### 3. **ä»£ç¢¼æ¨¡å¼å•é¡Œ**

æŸäº›æ¼æ´ä»£ç¢¼å¯èƒ½éœ€è¦èª¿æ•´ä»¥ç¬¦åˆ Semgrep è¦å‰‡çš„åŒ¹é…æ¨¡å¼ï¼š

```python
# ç¯„ä¾‹ï¼šCWE-327 æœªè¢«æª¢æ¸¬
hash_object = hashlib.md5(data)  # âŒ æœªæª¢æ¸¬

# å¯èƒ½éœ€è¦ï¼š
hashlib.md5()  # Semgrep å¯èƒ½åªåŒ¹é…ç›´æ¥èª¿ç”¨
```

---

## ğŸ’¡ æ”¹é€²å»ºè­°

### ç«‹å³ä¿®å¾©ï¼ˆé«˜å„ªå…ˆç´šï¼‰

1. **ä¿®æ­£è¦å‰‡é…ç½®éŒ¯èª¤**
   ```python
   # éœ€è¦æ›¿æ›æˆ–ç§»é™¤ä»¥ä¸‹è¦å‰‡ï¼š
   "022": "r/python.lang.security.audit.path-traversal-open",  # ç„¡æ•ˆ
   "113": "r/python.django.security.injection.header-injection",  # ç„¡æ•ˆ
   "377": "r/python.lang.security.audit.insecure-temp-file",  # ç„¡æ•ˆ
   "643": "r/python.lxml.security.xpath-injection",  # ç„¡æ•ˆ
   "943": "r/python.django.security.injection.sql.sql-injection-db-cursor-execute",  # ç„¡æ•ˆ
   ```

2. **ä½¿ç”¨æ›´é€šç”¨çš„è¦å‰‡**
   ```python
   # æ¨è–¦ä½¿ç”¨ ruleset (p/) è€Œéå…·é«”è¦å‰‡ (r/)
   "078": "p/python",  # Python å®‰å…¨è¦å‰‡é›†
   "502": "p/python",  # åŒ…å«æ‰€æœ‰ååºåˆ—åŒ–è¦å‰‡
   ```

### ä¸­æœŸæ”¹é€²ï¼ˆä¸­å„ªå…ˆç´šï¼‰

3. **è£œå……å¤šå€‹è¦å‰‡**
   ```python
   # ä¸€å€‹ CWE å¯ä»¥å°æ‡‰å¤šå€‹è¦å‰‡
   "327": "r/python.lang.security.audit.md5-used,r/python.lang.security.audit.sha1-used"
   "502": "r/python.lang.security.deserialization.avoid-pyyaml-load,r/python.lang.security.audit.dangerous-pickle-usage"
   ```

4. **èª¿æ•´æ¸¬è©¦æ¨£æœ¬**
   - ç¢ºä¿ç¯„ä¾‹ä»£ç¢¼ç¬¦åˆ Semgrep è¦å‰‡çš„åŒ¹é…æ¨¡å¼
   - åƒè€ƒ Semgrep å®˜æ–¹ç¯„ä¾‹

### é•·æœŸæ”¹é€²ï¼ˆä½å„ªå…ˆç´šï¼‰

5. **è€ƒæ…®ä½¿ç”¨ Semgrep Pro**
   - æä¾›æ›´å¤šé«˜ç´šè¦å‰‡
   - æ›´å¥½çš„èª¤å ±æ§åˆ¶

6. **è‡ªå®šç¾©è¦å‰‡**
   - ç‚ºç‰¹å®šå°ˆæ¡ˆéœ€æ±‚ç·¨å¯« YAML è¦å‰‡
   - æé«˜æª¢æ¸¬æº–ç¢ºæ€§

---

## ğŸ¯ é‡å° Python å°ˆæ¡ˆçš„å»ºè­°é…ç½®

åŸºæ–¼æ¸¬è©¦çµæœï¼Œä»¥ä¸‹æ˜¯æ¨è–¦çš„ Semgrep é…ç½®ç­–ç•¥ï¼š

### ç­–ç•¥ 1: ä½¿ç”¨è¦å‰‡é›† (Ruleset)

```python
SEMGREP_BY_CWE = {
    # ä½¿ç”¨ p/ (ruleset) åŒ…å«æ‰€æœ‰ç›¸é—œè¦å‰‡
    "078": "p/command-injection",
    "079": "p/xss",
    "095": "p/code-injection",
    "327": "p/crypto",
    "502": "p/deserialization",
}
```

**å„ªé»**: 
- âœ… è¦†è“‹é¢å»£
- âœ… è‡ªå‹•åŒ…å«æ–°è¦å‰‡
- âœ… æ›´å°‘çš„é…ç½®éŒ¯èª¤

**ç¼ºé»**:
- âš ï¸ å¯èƒ½ç”¢ç”Ÿæ›´å¤šå‡é™½æ€§
- âš ï¸ æƒææ™‚é–“æ›´é•·

### ç­–ç•¥ 2: æ··åˆä½¿ç”¨ (æ¨è–¦)

```python
SEMGREP_BY_CWE = {
    # å„ªå…ˆä½¿ç”¨é©—è­‰éçš„å…·é«”è¦å‰‡
    "095": "r/python.lang.security.audit.eval-detected",  # âœ… å·²é©—è­‰æœ‰æ•ˆ
    
    # å°ç„¡æ•ˆè¦å‰‡ä½¿ç”¨ ruleset
    "022": "p/path-traversal",  # æ›¿ä»£ç„¡æ•ˆçš„å…·é«”è¦å‰‡
    "502": "p/deserialization",  # æ›´å…¨é¢çš„è¦†è“‹
    
    # å®Œå…¨ä¾è³´ Bandit çš„ CWE
    # "113": None,  # Bandit å·²èƒ½æª¢æ¸¬
}
```

### ç­–ç•¥ 3: Semgrep + Bandit çµ„åˆ (ç•¶å‰æœ€ä½³)

```python
# æ ¹æ“šæª¢æ¸¬èƒ½åŠ›åˆ†é…æƒæå™¨ï¼š
- Semgrep æ“…é•·: 095 (Eval)
- Bandit æ“…é•·: 078, 326, 327, 377, 502, 918
- éƒ½ä¸ç†æƒ³: 022, 079, 113, 329, 347, 643, 760, 943
```

**å»ºè­°**: ç¹¼çºŒä½¿ç”¨ Bandit ä½œç‚ºä¸»è¦æƒæå™¨ï¼ŒSemgrep ä½œç‚ºè£œå……

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥æ¸¬è©¦è¨ˆåŠƒ

1. **è¦å‰‡é©—è­‰æ¸¬è©¦**
   - ä½¿ç”¨ `tests/validate_semgrep_rules.py` é‡æ–°é©—è­‰æ‰€æœ‰è¦å‰‡
   - è¨˜éŒ„å“ªäº›è¦å‰‡çœŸæ­£å­˜åœ¨æ–¼ Semgrep registry

2. **è¦å‰‡æ›¿æ›æ¸¬è©¦**
   - å˜—è©¦ä½¿ç”¨ ruleset (`p/`) æ›¿ä»£ç„¡æ•ˆçš„å…·é«”è¦å‰‡ (`r/`)
   - æ¸¬è©¦æª¢æ¸¬ç‡æ˜¯å¦æå‡

3. **æ¨£æœ¬ä»£ç¢¼å„ªåŒ–**
   - åƒè€ƒ Semgrep å®˜æ–¹ç¯„ä¾‹èª¿æ•´æ¸¬è©¦ä»£ç¢¼
   - ç¢ºä¿ä»£ç¢¼æ¨¡å¼åŒ¹é…è¦å‰‡

4. **è‡ªå®šç¾©è¦å‰‡é–‹ç™¼**
   - ç‚ºæœªè¦†è“‹çš„ CWE ç·¨å¯« Semgrep YAML è¦å‰‡
   - æ¸¬è©¦è‡ªå®šç¾©è¦å‰‡çš„æª¢æ¸¬æ•ˆæœ

---

## ğŸ“ çµè«–

### ç•¶å‰ç‹€æ³
- âŒ Semgrep å° Python å°ˆæ¡ˆçš„æª¢æ¸¬èƒ½åŠ›**é ä½æ–¼é æœŸ** (6.7%)
- âš ï¸ ä¸»è¦å•é¡Œæ˜¯**è¦å‰‡é…ç½®éŒ¯èª¤**ï¼Œè€Œéå·¥å…·æœ¬èº«ç¼ºé™·
- âœ… Bandit è¡¨ç¾æ›´å¥½ (46.7%)ï¼Œæ‡‰ç¹¼çºŒä½œç‚ºä¸»è¦æƒæå™¨

### æ”¹é€²æ½›åŠ›
- ğŸ”§ ä¿®æ­£è¦å‰‡é…ç½®å¾Œï¼Œé ä¼°å¯æå‡è‡³ **40-60% æª¢æ¸¬ç‡**
- ğŸš€ ä½¿ç”¨ ruleset å¾Œï¼Œé ä¼°å¯æå‡è‡³ **60-80% æª¢æ¸¬ç‡**
- ğŸ’¡ çµåˆ Bandit + Semgrepï¼Œå¯é”åˆ° **80-90% è¦†è“‹ç‡**

### æœ€çµ‚å»ºè­°
**é‡å° Python å°ˆæ¡ˆï¼Œæ¨è–¦çš„å®‰å…¨æƒæç­–ç•¥**:
1. **ä¸»æƒæå™¨**: Banditï¼ˆæª¢æ¸¬ç‡é«˜ã€èª¤å ±ä½ã€é…ç½®ç°¡å–®ï¼‰
2. **è¼”åŠ©æƒæå™¨**: Semgrepï¼ˆç‰¹å®šè¦å‰‡æª¢æ¸¬ã€æ·±åº¦åˆ†æï¼‰
3. **å„ªåŒ–æ–¹å‘**: ä¿®æ­£è¦å‰‡é…ç½®ï¼Œä½¿ç”¨ rulesetï¼Œé–‹ç™¼è‡ªå®šç¾©è¦å‰‡

---

**æ¸¬è©¦äººå“¡**: AI Assistant  
**ç›¸é—œæ–‡ä»¶**: 
- æ¸¬è©¦è…³æœ¬: `tests/test_all_cwe_samples.py`
- æ¸¬è©¦æ¨£æœ¬: `tests/test_samples/all_cwe_samples.py`
- è¦å‰‡é…ç½®: `src/cwe_detector.py`
